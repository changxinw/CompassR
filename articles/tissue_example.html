<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analyze multiple samples â€¢ CompassR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyze multiple samples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CompassR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/celltype_example.html">Analyze a single cell type across multiple samples</a></li>
    <li><a class="dropdown-item" href="../articles/integrat_inhouse_data.html">Integrating in-house data with CompassDB</a></li>
    <li><a class="dropdown-item" href="../articles/sample_example.html">Analyze a single sample</a></li>
    <li><a class="dropdown-item" href="../articles/tissue_example.html">Analyze multiple samples</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analyze multiple samples</h1>
            
      

      <div class="d-none name"><code>tissue_example.Rmd</code></div>
    </div>

    
    
<p>Example of CompassR analysis of the mouse Myh6 gene, which has
important functions in cardiac muscle contraction and adult heart
development. We selected a group of samples from different mouse
tissues, including gastrocnemius, heart, hippocampus, and cerebral
cortex, for visualization. For each sample, CompassR visualizes the
expression of Myh6 gene and the genomic locations of Myh6-linked CREs
whose chromatin accessibility is significantly associated with the gene
expression of Myh6. CompassR also visualizes the genomic locations of
the Myh6 gene and a union set of Myh6-linked CREs across all
samples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://changxinw.github.io/CompassR/">CompassR</a></span><span class="op">)</span></span></code></pre></div>
<p>Load the data from CompassDB and extract the expression and linkage
information for the Myh6.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Example for Myh6 in mouse heart sample</span></span>
<span><span class="va">expr_vec</span> <span class="op">=</span> <span class="fu"><a href="../reference/query_exprssion.html">query_exprssion</a></span><span class="op">(</span><span class="st">"mm10"</span>, <span class="st">"Myh6"</span><span class="op">)</span></span>
<span><span class="va">link_res</span> <span class="op">=</span> <span class="fu"><a href="../reference/query_linkage.html">query_linkage</a></span><span class="op">(</span><span class="st">"mm10"</span>, <span class="st">"Myh6"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">link_df</span> <span class="op">=</span> <span class="va">link_res</span><span class="op">[[</span><span class="st">"linkage"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">sample_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">link_res</span><span class="op">[[</span><span class="st">"samples"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sample_df</span> <span class="op">=</span> <span class="va">sample_df</span><span class="op">[</span><span class="va">sample_df</span><span class="op">$</span><span class="va">donor_gender</span> <span class="op">==</span> <span class="st">"Male"</span>, <span class="op">]</span></span>
<span><span class="va">sample_df</span> <span class="op">=</span> <span class="va">sample_df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sample_id"</span>, <span class="st">"bio_source"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sample_df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sample"</span>, <span class="st">"Group"</span><span class="op">)</span></span>
<span><span class="va">sample_df</span> <span class="op">=</span> <span class="va">sample_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">sample_df</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">link_df</span> <span class="op">=</span> <span class="va">link_df</span><span class="op">[</span><span class="va">link_df</span><span class="op">$</span><span class="va">sample</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_df</span><span class="op">$</span><span class="va">Sample</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">expr_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">expr_vec</span><span class="op">)</span><span class="op">[</span><span class="va">sample_df</span><span class="op">$</span><span class="va">Sample</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">expr_df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gene"</span><span class="op">)</span></span>
<span><span class="va">expr_df</span><span class="op">$</span><span class="va">Sample</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">expr_df</span><span class="op">)</span></span></code></pre></div>
<p>Visuzalize the expression and linkage information for the Myh6 gene
on samples of interest.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### This can fail when ensemble server is down, if that is the case, please try it later</span></span>
<span><span class="va">link_df</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">=</span> <span class="va">link_df</span><span class="op">$</span><span class="va">sample</span></span>
<span><span class="fu"><a href="../reference/genome_track_map.html">genome_track_map</a></span><span class="op">(</span><span class="va">link_df</span>, <span class="va">sample_df</span>, <span class="st">"Myh6"</span>, <span class="va">expr_df</span>, assembly <span class="op">=</span> <span class="st">"mm10"</span>, legend.position<span class="op">=</span><span class="st">"left"</span>, t <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, b <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; the plot was flipped and the y limits will be applied to x-axis</span></span>
<span><span class="co">#&gt; Warning in get_plot_component(plot, "guide-box"): Multiple components found;</span></span>
<span><span class="co">#&gt; returning the first one. To return all, use `return_all = TRUE`.</span></span></code></pre></div>
<p><img src="tissue_example_files/figure-html/unnamed-chunk-3-1.png" width="700"><img src="tissue_example_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<p>Extract the CREs linked to Myh6 expression in heart and plot the TF
binding information.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">track_plot</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_genome_track.html">plot_genome_track</a></span><span class="op">(</span><span class="va">link_df</span>, <span class="st">"Myh6"</span>, <span class="st">"mm10"</span>, <span class="va">sample_df</span><span class="op">$</span><span class="va">Sample</span><span class="op">)</span></span></code></pre></div>
<p><img src="tissue_example_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peaks</span> <span class="op">=</span> <span class="va">track_plot</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">track_plot</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">peaks</span><span class="op">$</span><span class="va">name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">peaks</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="va">peak_order</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_peak_group.html">make_peak_group</a></span><span class="op">(</span><span class="va">link_df</span>, <span class="va">peaks</span>, <span class="va">sample_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ht_peak_order</span> <span class="op">=</span> <span class="va">peak_order</span><span class="op">[</span><span class="va">peak_order</span><span class="op">[</span>, <span class="st">"Heart"</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">peak_order</span><span class="op">[</span>, <span class="st">"Gastrocnemius"</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">peak_order</span><span class="op">[</span>, <span class="st">"Layer of hippocampus"</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">peak_order</span><span class="op">[</span>, <span class="st">"Left cerebral cortex"</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0.5</span>, <span class="op">]</span></span>
<span><span class="va">ht_peaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ht_peak_order</span><span class="op">)</span></span>
<span></span>
<span><span class="va">peak_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">":"</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">peaks</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ht_peaks</span> <span class="op">=</span> <span class="va">peak_vec</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ht_peaks</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">tf</span> <span class="op">=</span> <span class="fu"><a href="../reference/tf_binding.html">tf_binding</a></span><span class="op">(</span><span class="st">"mm10"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ht_peaks</span>, collapse <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_giggle.html">plot_giggle</a></span><span class="op">(</span><span class="va">tf</span><span class="op">)</span></span></code></pre></div>
<p><img src="tissue_example_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Changxin Wan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
